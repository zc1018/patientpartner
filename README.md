# 滴滴陪诊业务沙箱模拟系统

基于真实行业数据的陪诊业务沙箱模拟环境，用于 GMV 预测、运营决策支持和业务参数验证。

## 项目背景

本项目模拟滴滴陪诊业务的完整运营流程，核心参数基于外部研究数据修正（v2.0），相比原始假设更贴近真实市场表现：

| 参数 | 原假设 | 修正后 | 数据来源 |
|------|--------|--------|---------|
| 首单复购率 | 30% | **13.5%** | Dialog Health 患者留存研究 |
| 30天留存率 | 未定义 | **45%** | 医疗 App 行业数据 |
| NPS 评分 | 未定义 | **-22.5%** | 金融/医疗行业基准 |
| 指定陪诊师复购率 | 未定义 | **82%** | 行业调研数据 |
| 投诉率影响 | 未定义 | **-0.45%转化率/1%投诉** | 医疗健康营销案例 |

## 核心功能

### 需求侧
- **时段需求建模** — 早高峰(1.8x)/午间(1.2x)/下午(1.5x)/晚间(0.8x) 真实需求分布
  - 周末效应(0.8x)与月末效应(1.15x)互斥，避免叠加错误
  - 节假日因素：春节(-70%)/国庆(-40%) 基于真实日历
- **年龄分层行为** — 60-70岁(子女代购40%)/70-80岁(70%)/80+岁(90%，无法独立使用App)
  - 差异化复购周期：60-70岁(180天)/70-80岁(90天)/80+岁(45天)
- **用户生命周期状态机** — active → at_risk(30天) → churned(90天)
  - 分层流失率：首单用户(55%/月)/2-3单用户(25%/月)/老客(10%/月)
- **NPS 口碑传播** — 推荐者/被动者/批评者分类，推荐转化率 7.5%
- **投诉率联动** — 投诉率每↑1% → 转化率↓0.45%，实时影响需求生成

### 供给侧
- **陪诊员招募衰减** — 52周后最低维持40%招募能力
  - 动态招募：订单增长>20%时加速招募
- **培训体系** — 基础培训(7天)/专业培训(21天)，通过率70%
  - 培训期计算修复：基于入职天数而非模拟天数
- **接单意愿模型** — 收入达标(90%/50%/20%)×价格因素(1.2x/0.7x)×疲劳效应(每单-20%)
- **动态评分系统** — 评分随订单动态更新(加权平均90%+10%)
  - 评分影响日接单上限：4.9+(4单)/4.7+(3单)/4.3+(2单)/<4.3(1单)
- **收入分层流失** — 高收入>300元/天(8%/月)/中收入150-300元/天(15%/月)/低收入<150元/天(25%/月)

### 匹配引擎
- **三级匹配优先级** — 指定陪诊师(82%复购) → 历史陪诊师(50%复购) → 普通匹配(30%复购)
- **拒单重匹配机制** — 陪诊员拒单后订单保留等待队列，排除已拒单陪诊员后重新匹配
  - 最大重试次数限制(10次)，防止订单无限等待
- **时间冲突检测** — 实时检测陪诊师时间冲突
- **地理距离约束** — Haversine距离计算，通勤时间不超过90分钟
- **限制医院准入** — 18家三甲医院(协和/301/北医三院等)，无证陪诊师完全无法进入

### 财务分析
- **CAC 渠道差异化** — 线上广告80元/口碑推荐20元/医院合作150元/地推60元
- **盈亏平衡分析** — 固定成本/边际贡献计算，预测盈亏平衡周数
- **单位经济模型** — LTV/CAC 比率（健康指标 >3）

### 蒙特卡洛模拟
- **多参数不确定性分析** — 同时模拟多个关键参数的波动影响
- **P0级参数覆盖** —
  - 首单复购率(13.5% ± 3.5%)
  - 指定陪诊师复购率(82% ± 7%)
  - NPS评分(-22.5% ± 7.5%)
  - 投诉率(1% ± 2%)
  - 曝光率/点击率/转化率等运营指标
- **置信区间计算** — 提供95%置信区间和场景概率分布

### 市场竞争
- **真实竞争格局** — 医院自营40%/个人陪诊师35%/滴滴15%/其他10%
  - 差异化竞争策略：医院自营提升质量/个人陪诊师价格战/滴滴品牌溢价/其他平台跟随
- **竞品挖角模拟** — 陪诊师流失率动态调整
  - 医院自营份额稳定(变化弹性2%)/滴滴份额可快速增长(变化弹性15%)

## 项目结构

```
src/
├── config/
│   ├── settings.py              # 核心配置（含修正参数）
│   └── integrated_data_config.yaml
├── models/
│   └── entities.py             # User、Order、Escort 数据模型
├── modules/
│   ├── demand.py                # 需求生成（年龄分层 + 子女代购）
│   ├── demand_enhanced.py       # 增强需求（时段分布 + 渠道细分）
│   ├── supply.py                # 供给模拟（招募衰减 + 培训体系）
│   ├── matching.py              # 三级匹配引擎
│   ├── matching_enhanced.py     # 增强匹配（时间冲突 + 地理约束）
│   ├── analytics.py             # 数据分析（LTV/CAC/盈亏平衡）
│   ├── monte_carlo.py           # 蒙特卡洛模拟
│   ├── competition.py           # 市场竞争模型
│   ├── complaint_handler.py     # 投诉处理
│   ├── geo_matcher.py          # 地理位置匹配
│   ├── referral_system.py       # NPS 口碑传播
│   └── user_lifecycle_tracker.py
├── agents/
│   ├── user_behavior_agent.py  # 用户行为（生命周期 + 年龄分层）
│   └── market_dynamics_agent.py # 市场动态
├── simulation/
│   ├── simulation.py            # 基础模拟引擎
│   └── simulation_competitive.py # 竞争模拟引擎
└── simulation.py               # 主入口
```

## 快速开始

```bash
# 安装依赖
pip install -r requirements.txt

# 运行 90 天模拟
python -c "
from src.config.settings import SimulationConfig
from src.simulation_competitive import CompetitiveSimulation

config = SimulationConfig(total_days=90, enable_llm=False)
sim = CompetitiveSimulation(config)
result = sim.run()
"
```

## 关键业务指标

| 指标 | 当前基准 | 目标（3个月） |
|------|---------|-------------|
| 首单复购率 | 13.5% | 18% |
| 30天留存率 | 45% | 60% |
| 指定陪诊师渗透率 | 20% | 70% |
| NPS 评分 | -22.5% | 0% |

## GMV 预测（年度，基于修正参数）

| 场景 | 年度 GMV |
|------|---------|
| 保守 | 0.20 亿元 |
| 中性 | 0.39 亿元 |
| 乐观 | 0.77 亿元 |

## 技术栈

- Python 3.10+
- NumPy / Pandas — 数值计算
- Rich — 终端可视化
- 模板方法模式 — 模拟引擎架构
- 多智能体系统 — 用户行为和市场动态模拟

## 版本历史

- **v2.0** — 基于外部研究数据全面修正核心参数（首单复购率13.5%、NPS -22.5%）
- **v2.1** — 增强匹配引擎、时段需求建模、CAC渠道差异化
- **v2.2** — 年龄分层行为、用户生命周期状态机、盈亏平衡分析
- **v2.3** — 投诉率联动、分层流失率、节假日因素
- **v2.4** — 拒单重匹配、动态评分系统、接单意愿模型
- **v2.5** — 差异化竞争策略、限制医院扩展、蒙特卡洛参数完善
